import asyncio
from typing import Dict, Any
from app.config import settings

_cached_rules = {}

def _get_default_rules(language: str = "ru") -> str:
    if language == "en":
        return """
üîí <b>Service Usage Rules</b>

1. It is forbidden to use the service for illegal activities
2. Copyright infringement is prohibited
3. Spam and malware distribution are prohibited
4. Using the service for DDoS attacks is prohibited
5. One account - one user
6. Refunds are made only in exceptional cases
7. Administration reserves the right to block an account for violating the rules

<b>By accepting the rules, you agree to comply with them.</b>
"""
    else:
        return """
üìã <b>–ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞</b>

1. –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
2. –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤
3. –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è —Å–ø–∞–º –∏ —Ä–∞—Å—Å—ã–ª–∫–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –ü–û
4. –ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è DDoS –∞—Ç–∞–∫
5. –û–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç - –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
6. –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö
7. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª

<b>–ü—Ä–∏–Ω–∏–º–∞—è –ø—Ä–∞–≤–∏–ª–∞, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å–æ–±–ª—é–¥–∞—Ç—å –∏—Ö.</b>
"""

class Texts:
    def __init__(self, language: str = "ru"):
        self.language = language
    
    @property
    def RULES_TEXT(self) -> str:
        if self.language in _cached_rules:
            return _cached_rules[self.language]
        
        return _get_default_rules(self.language)
    
    BACK = "‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
    CANCEL = "‚ùå –û—Ç–º–µ–Ω–∞"
    CONFIRM = "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"
    CONTINUE = "‚û°Ô∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
    YES = "‚úÖ –î–∞"
    NO = "‚ùå –ù–µ—Ç"
    LOADING = "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞..."
    ERROR = "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞"
    SUCCESS = "‚úÖ –£—Å–ø–µ—à–Ω–æ"
    
    @staticmethod
    def format_price(kopeks: int) -> str:
        return f"{int(kopeks / 100)} ‚ÇΩ"
    
    @staticmethod
    def format_traffic(gb: float) -> str:
        if gb == 0:
            return "‚àû (–±–µ–∑–ª–∏–º–∏—Ç)"
        elif gb >= 1024:
            return f"{gb/1024:.1f} –¢–ë"
        else:
            return f"{gb:.0f} –ì–ë"


class RussianTexts(Texts):
    
    def __init__(self):
        super().__init__("ru")
    
    WELCOME = """
üéâ <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VPN —Å–µ—Ä–≤–∏—Å!</b>

–ù–∞—à —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±—ã—Å—Ç—Ä—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

üîê <b>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</b>
‚Ä¢ –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ –°–µ—Ä–≤–µ—Ä—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö
‚Ä¢ –ù–∞–¥–µ–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
"""
    
    LANGUAGE_SELECTED = "üåê –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: <b>–†—É—Å—Å–∫–∏–π</b>"
    
    RULES_ACCEPT = "‚úÖ –ü—Ä–∏–Ω–∏–º–∞—é –ø—Ä–∞–≤–∏–ª–∞"
    RULES_DECLINE = "‚ùå –ù–µ –ø—Ä–∏–Ω–∏–º–∞—é"
    RULES_REQUIRED = "‚ùóÔ∏è –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞!"
    
    REFERRAL_CODE_QUESTION = """
ü§ù <b>–£ –≤–∞—Å –µ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –æ—Ç –¥—Ä—É–≥–∞?</b>

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ –∏–ª–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –æ—Ç –¥—Ä—É–≥–∞, –≤–≤–µ–¥–∏—Ç–µ –µ—ë —Å–µ–π—á–∞—Å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å!

–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å":
"""
    
    REFERRAL_CODE_APPLIED = "üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω! –í—ã –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏."
    REFERRAL_CODE_INVALID = "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥"
    REFERRAL_CODE_SKIP = "‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
       
    MAIN_MENU = """üë§ <b>{user_name}</b>
    
üì± <b>–ü–æ–¥–ø–∏—Å–∫–∞:</b> {subscription_status}

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
"""
    
    MENU_BALANCE = "üí∞ –ë–∞–ª–∞–Ω—Å"
    MENU_SUBSCRIPTION = "üì± –ü–æ–¥–ø–∏—Å–∫–∞"
    MENU_TRIAL = "üß™ –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞"
    MENU_BUY_SUBSCRIPTION = "üíé –ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
    MENU_EXTEND_SUBSCRIPTION = "‚è∞ –ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
    MENU_PROMOCODE = "üé´ –ü—Ä–æ–º–æ–∫–æ–¥"
    MENU_REFERRALS = "ü§ù –†–µ—Ñ–µ—Ä–∞–ª—ã"
    MENU_SUPPORT = "üõ†Ô∏è –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    MENU_RULES = "üìã –ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–∏—Å–∞"
    MENU_LANGUAGE = "üåê –Ø–∑—ã–∫"
    MENU_ADMIN = "‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"
    BALANCE_BUTTON = "üí∞ –ë–∞–ª–∞–Ω—Å: {balance}"
    BALANCE_BUTTON_ZERO = "üí∞ –ë–∞–ª–∞–Ω—Å: 0 ‚ÇΩ"
    
    SUBSCRIPTION_NONE = "‚ùå –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏"
    SUBSCRIPTION_TRIAL = "üß™ –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞"
    SUBSCRIPTION_ACTIVE = "‚úÖ –ê–∫—Ç–∏–≤–Ω–∞"
    SUBSCRIPTION_EXPIRED = "‚è∞ –ò—Å—Ç–µ–∫–ª–∞"
    
    SUBSCRIPTION_INFO = """
üì± <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ</b>

üìä <b>–°—Ç–∞—Ç—É—Å:</b> {status}
üé≠ <b>–¢–∏–ø:</b> {type}
üìÖ <b>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</b> {end_date}
‚è∞ <b>–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π:</b> {days_left}

üìà <b>–¢—Ä–∞—Ñ–∏–∫:</b> {traffic_used} / {traffic_limit}
üåç <b>–°–µ—Ä–≤–µ—Ä—ã:</b> {countries_count} —Å—Ç—Ä–∞–Ω
üì± <b>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</b> {devices_used} / {devices_limit}

üí≥ <b>–ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂:</b> {autopay_status}
"""
    
    TRIAL_AVAILABLE = """
üéÅ <b>–¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</b>

–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É:

‚è∞ <b>–ü–µ—Ä–∏–æ–¥:</b> {days} –¥–Ω–µ–π
üìà <b>–¢—Ä–∞—Ñ–∏–∫:</b> {traffic} –ì–ë
üì± <b>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</b> {devices} —à—Ç.
üåç <b>–°–µ—Ä–≤–µ—Ä:</b> 1 —Å—Ç—Ä–∞–Ω–∞

–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É?
"""
    
    TRIAL_ACTIVATED = "üéâ –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!"
    TRIAL_ALREADY_USED = "‚ùå –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —É–∂–µ –±—ã–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞"
    
    BUY_SUBSCRIPTION_START = """
üíé <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏</b>

–î–∞–≤–∞–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏–º –≤–∞—à—É –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–¥ –≤–∞—à–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏.

–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏:
"""
    
    SELECT_PERIOD = "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥:"
    SELECT_TRAFFIC = "–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç —Ç—Ä–∞—Ñ–∏–∫–∞:"
    SELECT_COUNTRIES = "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—ã:"
    SELECT_DEVICES = "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤:"
    
    PERIOD_14_DAYS = f"üìÖ 14 –¥–Ω–µ–π - {settings.format_price(settings.PRICE_14_DAYS)}"
    PERIOD_30_DAYS = f"üìÖ 30 –¥–Ω–µ–π - {settings.format_price(settings.PRICE_30_DAYS)}"
    PERIOD_60_DAYS = f"üìÖ 60 –¥–Ω–µ–π - {settings.format_price(settings.PRICE_60_DAYS)}"
    PERIOD_90_DAYS = f"üìÖ 90 –¥–Ω–µ–π - {settings.format_price(settings.PRICE_90_DAYS)}"
    PERIOD_180_DAYS = f"üìÖ 180 –¥–Ω–µ–π - {settings.format_price(settings.PRICE_180_DAYS)}"
    PERIOD_360_DAYS = f"üìÖ 360 –¥–Ω–µ–π - {settings.format_price(settings.PRICE_360_DAYS)}"
    
    TRAFFIC_5GB = f"üìä 5 –ì–ë - {settings.format_price(settings.PRICE_TRAFFIC_5GB)}"
    TRAFFIC_10GB = f"üìä 10 –ì–ë - {settings.format_price(settings.PRICE_TRAFFIC_10GB)}"
    TRAFFIC_25GB = f"üìä 25 –ì–ë - {settings.format_price(settings.PRICE_TRAFFIC_25GB)}"
    TRAFFIC_50GB = f"üìä 50 –ì–ë - {settings.format_price(settings.PRICE_TRAFFIC_50GB)}"
    TRAFFIC_100GB = f"üìä 100 –ì–ë - {settings.format_price(settings.PRICE_TRAFFIC_100GB)}"
    TRAFFIC_250GB = f"üìä 250 –ì–ë - {settings.format_price(settings.PRICE_TRAFFIC_250GB)}"
    TRAFFIC_UNLIMITED = f"üìä –ë–µ–∑–ª–∏–º–∏—Ç - {settings.format_price(settings.PRICE_TRAFFIC_UNLIMITED)}"
    
    SUBSCRIPTION_SUMMARY = """
üìã <b>–ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</b>

üìÖ <b>–ü–µ—Ä–∏–æ–¥:</b> {period} –¥–Ω–µ–π
üìà <b>–¢—Ä–∞—Ñ–∏–∫:</b> {traffic}
üåç <b>–°—Ç—Ä–∞–Ω—ã:</b> {countries}
üì± <b>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</b> {devices}

üí∞ <b>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</b> {total_price}

–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É?
"""
    
    INSUFFICIENT_BALANCE = """‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ.  
    
    <b>–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ {amount} –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</b>
    """
    GO_TO_BALANCE_TOP_UP = "üí≥ –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é –±–∞–ª–∞–Ω—Å–∞"
    SUBSCRIPTION_PURCHASED = "üéâ –ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∞!"
    
    BALANCE_INFO = """
üí∞ <b>–ë–∞–ª–∞–Ω—Å: {balance}</b>

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
"""
    
    BALANCE_HISTORY = "üìä –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π"
    BALANCE_TOP_UP = "üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å"
    BALANCE_SUPPORT_REQUEST = "üõ†Ô∏è –ó–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É"
    
    TOP_UP_AMOUNT = "üí≥ –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (–≤ —Ä—É–±–ª—è—Ö):"
    TOP_UP_METHODS = """
üí≥ <b>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</b>

–°—É–º–º–∞: {amount}
"""
    
    TOP_UP_STARS = "‚≠ê Telegram Stars"
    TOP_UP_TRIBUTE = "üíé –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞"
    
    PROMOCODE_ENTER = "üé´ –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥:"
    PROMOCODE_SUCCESS = "üéâ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! {description}"
    PROMOCODE_INVALID = "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥"
    PROMOCODE_EXPIRED = "‚ùå –ü—Ä–æ–º–æ–∫–æ–¥ –∏—Å—Ç–µ–∫"
    PROMOCODE_USED = "‚ùå –ü—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω"
    
    REFERRAL_INFO = """
ü§ù <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b>

üë• <b>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ:</b> {referrals_count} –¥—Ä—É–∑–µ–π
üí∞ <b>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</b> {earned_amount}

üîó <b>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>
<code>{referral_link}</code>

üé´ <b>–í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥:</b>
<code>{referral_code}</code>

üí∞ <b>–£—Å–ª–æ–≤–∏—è:</b>
‚Ä¢ –ó–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞: {registration_bonus}
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç —Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π: {commission_percent}%
"""
    
    REFERRAL_INVITE_MESSAGE = """
üéØ <b>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ VPN —Å–µ—Ä–≤–∏—Å</b>

–ü—Ä–∏–≤–µ—Ç! –ü—Ä–∏–≥–ª–∞—à–∞—é —Ç–µ–±—è –≤ –æ—Ç–ª–∏—á–Ω—ã–π VPN —Å–µ—Ä–≤–∏—Å!

üéÅ –ü–æ –º–æ–µ–π —Å—Å—ã–ª–∫–µ —Ç—ã –ø–æ–ª—É—á–∏—à—å –±–æ–Ω—É—Å: {bonus}

üîó –ü–µ—Ä–µ—Ö–æ–¥–∏: {link}
üé´ –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ–º–æ–∫–æ–¥: {code}

üí™ –ë—ã—Å—Ç—Ä–æ, –Ω–∞–¥–µ–∂–Ω–æ, –Ω–µ–¥–æ—Ä–æ–≥–æ!
"""
    
    CREATE_INVITE = "üìù –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ"

    TRIAL_ENDING_SOON = """
üéÅ <b>–¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —Å–∫–æ—Ä–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è!</b>

–í–∞—à–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤.

üíé <b>–ù–µ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞—Ç—å—Å—è –±–µ–∑ VPN?</b>
–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ –ø–æ–ª–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É!

üî• <b>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:</b>
‚Ä¢ 30 –¥–Ω–µ–π –≤—Å–µ–≥–æ –∑–∞ {price}
‚Ä¢ –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫  
‚Ä¢ –í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã
‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å –¥–æ 1–ì–ë–∏—Ç/—Å–µ–∫

‚ö°Ô∏è –£—Å–ø–µ–π—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞!
"""

    MAINTENANCE_MODE_ACTIVE = """
üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã!

–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.

‚è∞ –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
üîÑ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ

–ü—Ä–∏–Ω–æ—Å–∏–º –∏–∑–≤–∏–Ω–µ–Ω–∏—è –∑–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–æ–±—Å—Ç–≤–∞.
"""

    MAINTENANCE_MODE_API_ERROR = """
üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã!

–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å–µ—Ä–≤–µ—Ä–∞–º.

‚è∞ –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.

üîÑ –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: {last_check}
"""

    SUBSCRIPTION_EXPIRING_PAID = """
‚ö†Ô∏è <b>–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ {days_text}!</b>

–í–∞—à–∞ –ø–ª–∞—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç {end_date}.

üí≥ <b>–ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂:</b> {autopay_status}

{action_text}
"""

    AUTOPAY_ENABLED_TEXT = "–í–∫–ª—é—á–µ–Ω - –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
    AUTOPAY_DISABLED_TEXT = "–û—Ç–∫–ª—é—á–µ–Ω - –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ–¥–ª–∏—Ç—å –≤—Ä—É—á–Ω—É—é!"

    SUBSCRIPTION_EXPIRED = """
‚ùå <b>–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞</b>

–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞. –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.

üîß –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è.
"""

    AUTOPAY_SUCCESS = """
‚úÖ <b>–ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂ –≤—ã–ø–æ–ª–Ω–µ–Ω</b>

–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–Ω–∞ –Ω–∞ {days} –¥–Ω–µ–π.
–°–ø–∏—Å–∞–Ω–æ —Å –±–∞–ª–∞–Ω—Å–∞: {amount}

–ù–æ–≤–∞—è –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è: {new_end_date}
"""

    AUTOPAY_FAILED = """
‚ùå <b>–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∞</b>

–ù–µ —É–¥–∞–ª–æ—Å—å —Å–ø–∏—Å–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏.

üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {balance}
üí≥ –¢—Ä–µ–±—É–µ—Ç—Å—è: {required}

–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∏ –ø—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –≤—Ä—É—á–Ω—É—é.
"""
    
    SUPPORT_INFO = f"""
üõ†Ô∏è <b>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</b>

–ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–µ:

üë§ {settings.SUPPORT_USERNAME}

–ú—ã –ø–æ–º–æ–∂–µ–º —Å:
‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ –†–µ—à–µ–Ω–∏–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º  
‚Ä¢ –í–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ –æ–ø–ª–∞—Ç–µ
‚Ä¢ –î—Ä—É–≥–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏

‚è∞ –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: –æ–±—ã—á–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —á–∞—Å–æ–≤
"""
    
    CONTACT_SUPPORT = "üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É"
    
    ADMIN_PANEL = """
‚öôÔ∏è <b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</b>

–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
"""
    
    ADMIN_USERS = "üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
    ADMIN_SUBSCRIPTIONS = "üì± –ü–æ–¥–ø–∏—Å–∫–∏"
    ADMIN_PROMOCODES = "üé´ –ü—Ä–æ–º–æ–∫–æ–¥—ã"
    ADMIN_MESSAGES = "üì® –†–∞—Å—Å—ã–ª–∫–∏"
    ADMIN_MONITORING = "üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"
    ADMIN_REFERRALS = "ü§ù –†–µ—Ñ–µ—Ä–∞–ª—ã"
    ADMIN_RULES = "üìã –ü—Ä–∞–≤–∏–ª–∞"
    ADMIN_REMNAWAVE = "üñ•Ô∏è Remnawave"
    ADMIN_STATISTICS = "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
    
    ACCESS_DENIED = "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"
    USER_NOT_FOUND = "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"
    SUBSCRIPTION_NOT_FOUND = "‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
    INVALID_AMOUNT = "‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞"
    OPERATION_CANCELLED = "‚ùå –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞"
    
    SUBSCRIPTION_EXPIRING = """
‚ö†Ô∏è <b>–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç!</b>

–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ {days} –¥–Ω–µ–π.

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º.
"""
    
    SUBSCRIPTION_EXPIRED = """
‚ùå <b>–ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞</b>

–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞. –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.
"""
    
    AUTOPAY_SUCCESS = """
‚úÖ <b>–ê–≤—Ç–æ–ø–ª–∞—Ç–µ–∂ –≤—ã–ø–æ–ª–Ω–µ–Ω</b>

–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–Ω–∞ –Ω–∞ {days} –¥–Ω–µ–π.
–°–ø–∏—Å–∞–Ω–æ —Å –±–∞–ª–∞–Ω—Å–∞: {amount}
"""
    
    AUTOPAY_FAILED = """
‚ùå <b>–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∞</b>

–ù–µ —É–¥–∞–ª–æ—Å—å —Å–ø–∏—Å–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏.
–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ: {balance}
–¢—Ä–µ–±—É–µ—Ç—Å—è: {required}

–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∏ –ø—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –≤—Ä—É—á–Ω—É—é.
"""


class EnglishTexts(Texts):
    
    def __init__(self):
        super().__init__("en")
    
    WELCOME = """
üéâ <b>Welcome to VPN Service!</b>

Our service provides fast and secure internet access without restrictions.

üîê <b>Advantages:</b>
‚Ä¢ High connection speed
‚Ä¢ Servers in different countries  
‚Ä¢ Reliable data protection
‚Ä¢ 24/7 support

To get started, select interface language:
"""
    
    LANGUAGE_SELECTED = "üåê Interface language set: <b>English</b>"
    
    BACK = "‚¨ÖÔ∏è Back"
    CANCEL = "‚ùå Cancel"
    CONFIRM = "‚úÖ Confirm"
    CONTINUE = "‚û°Ô∏è Continue"
    YES = "‚úÖ Yes"
    NO = "‚ùå No"

    MENU_BALANCE = "üí∞ Balance"
    MENU_SUBSCRIPTION = "üì± Subscription"
    MENU_TRIAL = "üéÅ Trial subscription"
    INSUFFICIENT_BALANCE = """‚ùå Insufficient balance. " \
    
    Top up {amount} and try again."""
    GO_TO_BALANCE_TOP_UP = "üí≥ Go to balance top up"
    

LANGUAGES = {
    "ru": RussianTexts,
    "en": EnglishTexts
}


def get_texts(language: str = "ru") -> Texts:
    return LANGUAGES.get(language, RussianTexts)()

async def get_rules_from_db(language: str = "ru") -> str:
    try:
        from app.database.database import get_db
        from app.database.crud.rules import get_current_rules_content
        
        async for db in get_db():
            rules = await get_current_rules_content(db, language)
            if rules:
                _cached_rules[language] = rules
                return rules
            break
            
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –∏–∑ –ë–î: {e}")
    
    default_rules = _get_default_rules(language)
    _cached_rules[language] = default_rules
    return default_rules

def get_rules_sync(language: str = "ru") -> str:
    try:
        if language in _cached_rules:
            return _cached_rules[language]
        
        loop = asyncio.new_event_loop()
        asyncio.set_event_loop(loop)
        rules = loop.run_until_complete(get_rules_from_db(language))
        loop.close()
        return rules
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª: {e}")
        return _get_default_rules(language)

async def refresh_rules_cache(language: str = "ru"):
    try:
        if language in _cached_rules:
            del _cached_rules[language]
        
        await get_rules_from_db(language)
        print(f"‚úÖ –ö–µ—à –ø—Ä–∞–≤–∏–ª –¥–ª—è —è–∑—ã–∫–∞ {language} –æ–±–Ω–æ–≤–ª–µ–Ω")
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–µ—à–∞ –ø—Ä–∞–≤–∏–ª: {e}")

def clear_rules_cache():
    global _cached_rules
    _cached_rules.clear()
    print("‚úÖ –ö–µ—à –ø—Ä–∞–≤–∏–ª –æ—á–∏—â–µ–Ω")
